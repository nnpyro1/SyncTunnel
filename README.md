# SyncTunnel 教程

***最新版本宣传片***

<video src="\https://ik.imagekit.io/nnpyro/SyncTunnel-xcps/beta-1-4-x%20(1).mp4?updatedAt=1756631622798" width="640" height="360" controls>
    您的浏览器不支持mp4视频
</video>

## 1 软件下载与安装
想要下载软件，你可以访问 [SyncTunnel的官网](https://nnpyro.netlify.app/synctunnel.html) 进行下载。  

## 2 软件操作
### 2.1 熟悉软件
本软件的最新版本是 `beta 1.2.7` 版本。  
`Beta 1.2.5`版本的界面如下 ：(beta 1.2.7版本的界面在下方**更新**区域) 
![beta 1.2.5界面](https://github.com/nnpyro1/html1/blob/071dcb8159ee5be023cd499eb4bdf80b4aadbe35/imgs_const/img_main.png?raw=true)

以下有对界面部分的介绍  
- 菜单栏:应用程序顶部包含了 `文件(F)` 的区域  
- 页面栏:应用程序左侧竖向的，包含 `文件视图` `设置` `用户协议` `调试`等按钮的区域
- 主页面:应用程序中间的大块区域
- 信息显示区:应用程序右下角显示了应用程序当前状态的区域  

>**更新**
>自`beta 1.2.7`开始，界面变更为
>![beta 1.2.7界面](https://github.com/nnpyro1/html1/blob/main/imgs_const/img_main_beta1.2.7.png?raw=true)

<a name="qs1"></a>

### 2.2 快速配置
> 本段讲述了安装应用程序后如何进行配置。
> 本应用程序以配置简单著称，配置过程十分精简。  
#### 2.2.1 必要配置
> 此段是使用软件必要的配置，配置完成后可以使用基础功能。  

想要使用本软件，你需要先设置用户名/加密密码。
1. 点击软件左侧页面栏的“设置”按钮，切换到设置页面。设置页面的界面如图所示：![设置页面](https://github.com/nnpyro1/html1/blob/main/imgs_const/img_settings.png?raw=true)  
2. 自己想一个用户名填写在 `用户名` 字段，填写密码到 `密码`字段。本软件**无需注册**,填写好后就生效。如果是刚刚下载本软件的用户，请**只填写用户名和密码字段**，不知用途，不要修改通信设置里面的内容。  
3. 填写完用户名密码核对无误后请点击 `保存设置` 按钮。应用程序自动重启，完成设置。

> ##### 重要安全提示
>请务必修改默认的用户名和密码。使用默认的用户名密码会让您的数据非常危险，极易被盗取。
>
>请务必记住您的密码。若密码遗忘会导致数据无法解密。
>
>本软件没有密码验证系统，这会导致两个人用一样的用户名时，软件自动将其视为同一个用户。请将用户名设为不容易重名的名字。请勿将用户名设为"666""1234"等重名率高的名字。建议用户名5字符以上。

*如果是刚刚下载本软件的用户，请点击[这里](#qs2)继续学习使用方法。*

#### 2.2.2 其他配置
##### 2.2.2.1 配置MQTT
>###### 重要安全提示
>用户信息使用范围
><br>
>本软件收集的通过MQTT传输的信息列表:
>- 用户由路由器映射的临时公网IP地址（含路由器公网IP）
>- 用户的公网IPv6地址（如果支持）  
>
>声明：
>本软件所有传输的数据都使用用户的密码进行AES-256加密，但使用的服务器是测试服务器broker.emqx.io:1883不保证联接的安全性。如果介意，请自行更换！
>开发者保证MQTT服务只传输上述列出的数据，不传输用户发送的文件内容，即使数据泄露，不会直接威胁到文件的安全。

软件提供更换MQTT服务器地址的功能。
输入服务器的地址和端口，点击 `保存设置`按钮，应用程序自动重启，完成设置。
如果服务器突然无法使用，可以尝试更换服务器。
下表列出了常见的服务器。注意：他们大多数是测试服务器，若需其他服务器可自行查找。主要的服务器提供商有[EMQ(现在称为EMQX)](https://broker.emqx.io)和[Mosquitto](https://test.mosquitto.org)

<table>
    <caption>免费MQTT服务器资源</caption>
    <thead>
        <tr>
            <th>名称</th>
            <th>地址(对应输入到<code>MQTT服务器地址</code>字段)</th>
            <th>端口地址(对应输入到<code>MQTT服务器端口</code>字段)</th>
            <th>备注</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>EMQ</td>
            <td>broker.emqx.io</td>
            <td>1883</td>
            <td>默认服务器</td>
        </tr>
        <tr>
            <td>EMQ</td>
            <td>broker-cn.emqx.io</td>
            <td>1883</td>
            <td>EMQ的中国服务器，未经测试</td>
        </tr>
        <tr>
            <td>EMQ</td>
            <td>broker.emqx.io</td>
            <td>8883</td>
            <td>EMQ的中国服务器，有TLS加密，保证数据安全，未经测试,大概率不兼容</td>
        </tr>
                <tr>
            <td>Mosquitto</td>
            <td>test.mosquitto.org</td>
            <td>1883</td>
            <td>未经测试</td>
        </tr>
    </tbody>
</table>
<br>
<br>
<a name="qs3"></a>

##### 2.2.2.2 配置文件挂起
前言：基础功能只能实现在两个客户端同时在线时才可以进行互传文件。当其中一方离线时，另一方无法得到文件。因此为了满足大部分的需要，SyncTunnel软件提供文件挂起服务.
文件挂起需要在最后一个客户端离线之前手动操作。后续会增加自动挂起功能。手动挂起后数据会保存在Github服务器上，等到第一个客户端上线后手动下载文件，自动删除Github上面的文件。
>###### 重要安全提示
>用户信息使用范围
>- 用户的文件数据（已加密）
>
>我们保证，只要用户正确设置了密码，文件一定会被加密。

<br>

###### 2.2.2.2.1 配置Github
1. 打开[Github官网](https://github.com)，点击右上角的`Sign up`按钮进入注册页面，或点击[链接](https://github.com/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F&source=header-home)直接进入注册页面，按照提示填写邮箱、密码、用户名（请记牢）和密码，验证账号后，进入[主页](https://github.com)
2. 点击右上角的`+`，在弹出的菜单中选择`new repository`或`新建仓库`
3. 填写字段：将`Repository name`字段填写为`synctunnel-filehangup`，建议把`Choose visibility`填写为`Private`
4. 点击右下角的绿色按钮，创建仓库。
5. 创建PAT：在主页点击右上角用户头像，选择弹出来的列表中的`Settings`按钮，在左侧的菜单中滚动到最底下，选择`Developer settings`。接着在新出现的页面中点击左侧的`Personal Access Tokens`，选择第一个`Fine-Grained tokens`，点击`Generate new token`，输入账户的密码。
6. 在页面中填写名称、描述等信息，滚动到底部，设置`Repository access`为`All repositories`。
7. 在页面底部的Permissions字段下面的方框的右上角点击`Add permissions`，选择`Contents`（温馨提示：不要用搜索工具，搜不出来）把新出现的两行的右边的下拉框都改成`Read and write`
最终效果如图所示![](https://github.com/nnpyro1/html1/blob/main/imgs_const/img_github1.png?raw=true)
8. 点击绿色按钮后尽快复制页面上的token。此token只显示一次，请务必妥善保存

###### 2.2.2.2.2 配置应用程序
![](https://github.com/nnpyro1/html1/blob/main/imgs_const/img_settings.png?raw=true)
打开SyncTunnel，转到“设置”页面，将注册Github时用的账号名称（不是邮件）填入`Github账号`字段，将刚刚复制的token填入`Github PAT`中，点击“保存设置”，应用程序自动重启，设置完成。

<br><br><br><a name="qs2"></a>

### 2.3 功能介绍与使用
#### 功能介绍
本软件是数据同步软件，可以在不同设备之间同步数据。默认情况采用STUN打洞进行文件同步。当路由器设备不支持STUN时可以自动切换到IPv6直连传输。
在使用之前，需要先点击左侧页面栏的`用户协议`认真阅读并同意。
>**更新**
>自beta 1.2.7开始，支持在设置页面手动切换到IPv6模式

#### 2.3.1 打开软件
打开软件时，新用户默认自动切换到`用户协议`页面，之后打开默认切换到`文件视图`页面。
打开软件后，请不要立即使用。请关注右下角的提示。
- 右下角显示"正在获取公网IP"且超过1秒，代表STUN失败。如果应用程序稍后没有自动重启，则说明成功切换到了IPv6模式，不影响使用。
- 显示"正在获取用户列表"，说明系统正在获取用户列表
- 显示"加载成功"后，方可开始使用

#### 2.3.2 同步文件
在同步文件前，请确保
- 你的用户名和密码与要同步的客户端的用户名和密码设置完全相同。只有相同的用户名和密码才可以相互同步文件。
- 文件列表中有文件或文件夹。如果没有，切换到`文件视图`页面，在页面空白处点击右键，选择"在文件管理器中打开"，放入文件后方可同步。

您可以通过按下快键键`Ctrl+U`或者点击菜单栏中的`文件`，点击`同步文件`来同步文件

下面是一份表格，标识了文件同步过程中右下角可能出现的文字
<table>
    <caption>发送端</caption>
    <thead>
        <tr>
            <th>出现的文字</th>
            <th>含义</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>正在加载文件</td>
            <td>正在对文件进行加载、加密、分片等操作</td>
        </tr>
        <tr>
            <td>正在发送文件，包1/1234 时间:3秒 速度1586kb/s</td>
            <td>文件正在发送，标识了速度、已用时间和发送进度</td>
        </tr>
        <tr>
            <td>发送文件完毕</td>
            <td>文件的发送操作完成。<strong>注意，文件没有真正发送完成，还有重传步骤未进行！</strong></td>
        </tr>
        <tr>
            <td>正在回复重传请求</td>
            <td>正在回复其他客户端发来的重传请求</td>
        </tr>
        <tr>
            <td>文件释放完成</td>
            <td>真正意义上的文件发送完成</td>
        </tr>
    </tbody>
</table>

<table>
    <caption>接收端</caption>
    <thead>
        <tr>
            <th>出现的文字</th>
            <th>含义</th>
        </tr>
    </thead>
    <tbody>
        <tr>
        <tr>
            <td>正在接收文件，包1/1234</td>
            <td>文件正在接收</td>
        </tr>
        <tr>
            <td>文件操作完成</td>
            <td>文件的操作完成。<strong>注意，文件没有真正接收完成，还有重传步骤未进行！</strong></td>
        </tr>
        <tr>
            <td>正在请求重传</td>
            <td>正在回复其他客户端发来的重传请求</td>
        </tr>
        <tr>
            <td>文件释放完成</td>
            <td>真正意义上的文件发送完成</td>
        </tr>
    </tbody>
</table>

注意：接收端最后可能不会显示`文件释放完成`，这是由于网络波动导致的bug，如果发送端显示了文件释放完成或者接收端10秒内没有接收到任何包，则也算完成。

#### 2.3.3 挂起文件
请确保已经按照上文所述设置了Github 账号和PAT。
在离线前，点击菜单栏的`文件`，点击`挂起文件`，开始挂起。
***注意，请勿在已经有文件挂起的时候再次进行文件挂起操作，否则会挂起失败！***
在上线后点击`文件`->`下载同步的文件`下载。

*如果是刚刚下载本软件的用户请点击[这里](#qs3)继续学习文件挂起配置*

<br>

## 3 常见问题
还没有常见问题。遇到问题请发送邮件到[nnpyro2@outlook.com](mailto:nnpyro2@outlook.com)

|问题描述|解决办法|版本|备注|
|-------|--------|---|---|
|在进入应用程序的时候弹出对话框显示“无法联接到MQTT服务器”|默认服务器`broker.emqx.io`因未知原因无法提供服务，请手动切换到`	test.mosquitto.org`|所有版本|无|
|在挂起文件时挂起失败|参见下文|所有版本|无|


### 3.1 文件挂起问题排查
首先你需要按照以下步骤先排查问题。在下文的行末会有像`这样`的字体，标识了问题的原因，其代表的具体信息和解决办法请到后面解决问题部分进行查阅。
- 在浏览器访问[Github](https://github.com)。若不能访问，则`服务器问题`
- 是否挂起了超过`336MB`(`beta 1.2.7`版本以前)/频繁操作？访问github网站，打开`synctunnel-filehangup`网站，在页面中间文件列表右上角的数字`1234 commits`是否超过5000? 是则`API限制`问题。
- 重试，是否可以成功挂起？是，则`偶然性问题`
- 在设置页面检查`Github 用户名`和`Github PAT`设置，特别是github网站上的权限配置。此设置**最容易出错**。如果出错，则是`配置错误`

<br>

**解决问题**

#### `服务器问题`
表示Github服务器出现问题。Github是国外服务器，国内特定地区联接不稳定。
解决办法：
- 使用Watt Toolkit或其他的网络加速服务
- 更换时间再试
- 修改hosts文件手动添加DNS解析
- 在[互联网上搜索`Github无法访问`的相关问题](https://cn.bing.com/search?q=Github无法访问)。只要网页版github可以访问，应用程序就可以访问。
- 使用代理服务器

#### `API限制`
Github限制API有**每小时5000次访问**限制。如果超出限制会禁止访问
解决办法：
- 不要频繁操作
- 更新最新版本。`beta 1.2.7(release 1)`及以前版本有上传缺陷，无法上传大于300MB以上内容。请更新到`beta 1.2.7 release 2`以上版本。
- 注册另一个github账号，一个账号达到限制使用另一个账号
- 耐心等待一个小时

#### `偶然性问题`
互联网环境复杂，容易出现网络波动等偶然性问题
解决办法：
- 重试

#### `配置错误`
配置Github时出错
解决办法：
- 严格按照上文操作重新配置
- 尤其检查Github用户名是否一致，Github PAT是否有`Contents`的Read and Write权限，是否设置`Repository access`为`All repositories`。如果不是请重新配置。
